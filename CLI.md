# ralph-cli Reference

CLI for managing ralph.json. Saves tokens — agents run short commands instead of reading/rewriting the full JSON. Handles timestamps, validation, and atomic writes.

**Setup:** `export RALPH_JSON=/absolute/path/to/ralph.json`

After running `scripts/setup.sh`, the `ralph` command is available system-wide.

## Quick Reference

```bash
ralph init --project "name" --repo "/path" --iterations 10   # Bootstrap ralph.json

ralph show                          # Compact project summary
ralph status                        # Print current status
ralph status running                # Set status (initialized|running|paused|completed)

ralph task ls                       # List all tasks by column
ralph task start 5                  # Backlog → current (validates depends_on, auto-timestamps)
ralph task complete --test pass --files "a.ts,b.ts"          # Current → completed
ralph task complete --test pass --files "a.ts" --next 6      # Complete + start next in one shot
ralph task retry                    # Increment retries on current task
ralph task promote 9                # Discovered → backlog

# Add tasks (pipe description via stdin)
echo "Description here" | ralph task add --id 11 --title "Fix bug" --skills "ts" --depends-on "4,5"

ralph commit abc123                 # Attach commit hash to last completed task
ralph iter                          # Increment iterations.actual

# Discovered tasks (pipe description via stdin)
echo "Description" | ralph discover --id 12 --title "Edge case" --source "Task #4"

ralph note "Important note"         # Append note
```

## Key Behaviors

- **`task start`** validates `depends_on` — refuses to start blocked tasks
- **`task start`** fails if there's already a current task
- **`task complete --next ID`** completes current + starts next atomically (Ralph uses this)
- **`task add`** reads description from stdin — pipe it in, don't pass as flag
- **`task add --acceptance`** uses `|` as separator: `"Criteria one|Criteria two"`
- All timestamps (`started_at`, `completed_at`) generated by CLI — agents don't need to
- Writes are atomic (temp file + rename) — no corruption risk
- Exits with code 1 on errors, code 0 on success

## Who Uses What

| Command | Supervisor | Ralph |
|---|---|---|
| `init` | yes | — |
| `show`, `task ls` | yes | yes |
| `status` | yes | — |
| `task start ID` | yes | — |
| `task complete` | — | yes |
| `task retry` | yes | — |
| `task add` | yes | — |
| `task promote` | yes | — |
| `commit` | yes | — |
| `iter` | yes | — |
| `discover` | — | yes |
| `note` | — | yes |
